<div style="text-align: center;">
  <h2>Interactive Tangent Line Visualizer</h2>
  <p>
    Enter a function of x (e.g. <code>x*x</code> or <code>Math.sin(x)</code>):<br>
    <input type="text" id="equationInput" value="x*x" style="width: 200px;">
  </p>
  <p>
    Move the slider to change <em>x</em> and see the tangent line update.<br>
    <input type="range" id="xSlider" min="-10" max="10" step="0.1" value="2" style="width: 80%;">
  </p>
  <canvas id="graphCanvas" width="600" height="400" style="border:1px solid #ccc;"></canvas>
</div>

<script>
const canvas = document.getElementById("graphCanvas");
const ctx = canvas.getContext("2d");
const slider = document.getElementById("xSlider");
const equationInput = document.getElementById("equationInput");

function f(x) {
  try {
    // Evaluate the user input safely
    return eval(equationInput.value);
  } catch (e) {
    return NaN;
  }
}

function derivative(f, x, h=0.0001) {
  return (f(x + h) - f(x - h)) / (2 * h);
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const scaleX = 30;   // pixels per unit
  const scaleY = 30;
  const originX = canvas.width / 2;
  const originY = canvas.height / 2;

  // draw axes
  ctx.strokeStyle = "#aaa";
  ctx.beginPath();
  ctx.moveTo(0, originY);
  ctx.lineTo(canvas.width, originY);
  ctx.moveTo(originX, 0);
  ctx.lineTo(originX, canvas.height);
  ctx.stroke();

  // plot function
  ctx.strokeStyle = "blue";
  ctx.beginPath();
  for (let px = 0; px < canvas.width; px++) {
    let x = (px - originX) / scaleX;
    let y = f(x);
    if (!isNaN(y)) {
      let py = originY - y * scaleY;
      if (px === 0) ctx.moveTo(px, py);
      else ctx.lineTo(px, py);
    }
  }
  ctx.stroke();

  // draw tangent line
  let x0 = parseFloat(slider.value);
  let y0 = f(x0);
  let m = derivative(f, x0);

  ctx.strokeStyle = "red";
  ctx.beginPath();
  for (let px = 0; px < canvas.width; px++) {
    let x = (px - originX) / scaleX;
    let y = m * (x - x0) + y0;
    let py = originY - y * scaleY;
    if (px === 0) ctx.moveTo(px, py);
    else ctx.lineTo(px, py);
  }
  ctx.stroke();
}

slider.addEventListener("input", draw);
equationInput.addEventListener("input", draw);

draw();
</script>
